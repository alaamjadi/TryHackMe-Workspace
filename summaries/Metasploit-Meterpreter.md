# Metasploit: Meterpreter

## Introduction

Meterpreter is a Metasploit payload that supports the penetration testing process with many valuable components. Meterpreter will run on the target system and act as an agent within a command and control architecture.

Meterpreter runs on the target system but is not installed on it. It runs in memory and does not write itself to the disk on the target. This feature aims to avoid being detected during antivirus scans.

Meterpreter also aims to avoid being detected by network-based IPS (Intrusion Prevention System) and IDS (Intrusion Detection System) solutions by using encrypted communication with the server where Metasploit runs (typically your attacking machine). If the target organization does not decrypt and inspect encrypted traffic (e.g. HTTPS) coming to and going out of the local network, IPS and IDS solutions will not be able to detect its activities.

Meterpreter is pretty stealthy but still most antiviruses will detect it. For example if you have a session to a windows machine and you get the PID of meterpreter (for example it might have name like spoolsv.exe) and step further too look at DLLs usde by its process using `tasklist /m /fi "pid eq <pid_of_meterpreter>"` you wouldn't get any meterpreter name mentioned somewhere. Meterpreter will establish an encrypted (TLS) communication channel with the attacker's system.

## Flavors & Versions

Metasploit payloads can be initially divided into two categories; inline (also called single) and staged. Staged payloads are sent to the target in two steps. An initial part is installed (the stager) and requests the rest of the payload. This allows for a smaller initial payload size. The inline payloads are sent in a single step. Meterpreter payloads are also divided into stagged and inline versions.

To list available Meterpreter versions use `msfvenom --list payloads | grep meterpreter`

Versions are available for Android, Apple iOS, Java, Linux, OSX, PHP, Python, Windows platforms.

To choose whcih version to use:

1. Target OS
2. Components available on taget
3. Network connection type

If you are not using Meterpreter as a standalone payload generated by Msfvenom, your choice may also be limited by the exploit.
